---
status: testing
phase: 06.1-transcription-state-architecture
source: [06.1-01-SUMMARY.md, 06.1-02-SUMMARY.md, 06.1-03-SUMMARY.md]
started: 2026-02-11T20:00:00Z
updated: 2026-02-11T20:00:00Z
---

## Current Test

number: 1
name: Transcription survives navigation
expected: |
Start a transcription on a project. While it's uploading or processing, navigate away (click a different project in the sidebar or go to settings). Then navigate back to the transcribing project. The transcription should still be running -- you should see ProgressStepper and/or LiveTranscriptView with segments appearing.
awaiting: user response

## Tests

### 1. Transcription survives navigation

expected: Start a transcription on a project. While it's uploading or processing, navigate away (click a different project or go to settings). Navigate back. The transcription should still be running with progress/live transcript visible.
result: issue
reported: "Stale closure fix applied (projectsRef). Completion now works -- project shows completed transcript with status badge. BUT two remaining issues: (1) /project/new still shows old transcript result instead of file upload (context state not reset), blocking new project creation via New Project button. (2) Completed transcript renders in a constrained height box -- content is cut off, should fill available space."
severity: major

### 2. Nav-away toast notification

expected: While a transcription is in progress, navigate away from the active project to another project or settings. A toast should appear saying "Transcription continuing in background" that disappears after ~3 seconds.
result: [pending]

### 3. Sidebar spinner for active transcription

expected: While a transcription is in progress, look at the sidebar. The actively transcribing project should show a small animated spinning indicator (indigo colored) next to its name, visually distinct from other status indicators.
result: [pending]

### 4. Concurrent upload blocked

expected: While a transcription is running, try to start a new transcription (click "New Project" or navigate to /project/new). Instead of the file upload UI, you should see a message that a transcription is already in progress with a button/link to view the active transcription.
result: [pending]

### 5. Completion toast from background

expected: Start a transcription, then navigate to a different project. Wait for it to finish. A success toast should appear saying "Transcription complete" with a clickable action to navigate to the completed project. The toast should stay visible for ~8 seconds.
result: [pending]

### 6. beforeunload confirmation during transcription

expected: While a transcription is in progress, try to close the browser tab or refresh (Cmd+R). The browser should show a native confirmation dialog ("Leave site?" or similar). Clicking "Stay"/"Cancel" keeps you on the page.
result: [pending]

### 7. Interrupted detection on force-refresh

expected: Start a transcription. While it's processing, force-refresh the browser (Cmd+R and confirm). After reload, the project that was mid-transcription should show an orange pulsing dot in the sidebar (visually distinct from the amber dot used for cancelled/error projects).
result: [pending]

### 8. Interrupted recovery card

expected: Click on an interrupted project (the one with the orange dot from test 7). The center panel should show an orange recovery card saying the transcription was interrupted, displaying any partially recovered segments, and offering a "Resume Transcription" button.
result: [pending]

### 9. MetadataPanel interrupted badge

expected: With an interrupted project selected, look at the right metadata panel. The status badge should show "interrupted" with an orange style (distinct from cancelled/error badges).
result: [pending]

### 10. API key warning during transcription

expected: While a transcription is in progress, navigate to Settings. The API key form should show an amber warning message about changing/removing the key during transcription. The "Clear Key" button should be disabled (greyed out). The "Save Key" button should remain clickable.
result: [pending]

## Summary

total: 10
passed: 0
issues: 1
pending: 9
skipped: 0

## Gaps

- truth: "Transcription survives navigation and shows completed transcript after processing finishes"
  status: partially-fixed
  reason: "Stale closure fixed (projectsRef). Completion now renders on the correct project. Two remaining issues: (1) /project/new still shows old transcript -- context state not reset after navigating to completed project, so New Project button is blocked. (2) Completed transcript renders in a constrained-height box instead of filling available space."
  severity: major
  test: 1
  root_cause: "Stale closure in startTranscription useCallback([]) reading projectsState.projects (empty at mount). FIXED with projectsRef pattern. Remaining: context machine state stuck at 'completed' when visiting /project/new (needs reset on project navigation), and TranscriptPanel/TranscriptView height constraint."
  artifacts:
  - path: "src/contexts/TranscriptionContext.tsx"
    issue: "Stale closure FIXED. Context state not auto-reset when user navigates away from completed project."
  - path: "src/features/project/ProjectPage.tsx"
    issue: "/project/new reads context state and shows completed transcript instead of file upload"
  - path: "src/features/dashboard/components/TranscriptPanel.tsx"
    issue: "Height constraint on completed transcript view"
    missing:
  - "Reset context state when navigating away from completed transcription project"
  - "Fix TranscriptPanel/TranscriptView height to fill available space"
    debug_session: ".planning/debug/transcription-completion-blocker.md"
