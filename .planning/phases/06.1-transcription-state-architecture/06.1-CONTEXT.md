# Phase 6.1: Transcription State Architecture - Context

**Gathered:** 2026-02-08
**Status:** Ready for planning

<domain>
## Phase Boundary

Lift transcription state out of ProjectPage into a context provider that survives route navigation. Currently, the useTranscription hook creates local component state via useReducer inside ProjectPage — navigating away destroys the state machine, abort controller, accumulated segments, and progress. The async Gemini operation continues running but the UI has no reference to it. This makes multi-project workflows fundamentally broken.

This phase makes transcription state screen-independent. It does NOT add new transcription capabilities, change the state machine transitions, or modify the Gemini API integration.

</domain>

<decisions>
## Implementation Decisions

### Concurrent transcription

- One transcription at a time — no parallel runs
- If a transcription is already running, block new uploads with a message like "Transcription already in progress" and link to the active project
- User has never needed parallel runs; the issue is navigating away mid-run, not running multiple

### Navigation behavior

- Free navigation always — user can browse any project, settings, etc. while transcription runs
- Transcription process must not depend on which screen is mounted
- Brief toast notification when user navigates away from active transcription ("Transcription continuing in background")
- Cancel button only accessible from the active project's view (navigate back via sidebar to cancel)
- Warn if user tries to change/remove API key in Settings during active transcription (would break the run)
- Settings page otherwise fully accessible during transcription

### State recovery on reload

- Browser refresh kills the async process — show partial transcript with a "Resume transcription" button (retry using persisted fileUri if within 48h, re-upload otherwise)
- Manual retry only — no auto-retry when user views an interrupted project
- Separate statuses for "cancelled by user" vs "interrupted by reload/crash" — different indicators and different implied actions
- Interrupted projects show a warning indicator (yellow/orange dot) in sidebar — distinct from the active spinner and from cancelled state

### Background visibility

- Animated spinner/pulse on the sidebar item for actively transcribing project
- On completion while viewing another screen: sidebar updates + clickable toast ("Interview with [name] — transcription complete", clicking navigates to project)
- On error while viewing another screen: same pattern — error toast (clickable) + sidebar error indicator (red/warning icon)
- When user navigates back to the active project: resume live view exactly as if they never left (live transcript, progress stepper, auto-scroll)

### Claude's Discretion

- Tab close behavior during active transcription (browser confirm dialog vs silent flush)
- Toast auto-dismiss timing and animation style
- Exact spinner/pulse animation design for sidebar
- Internal architecture of the TranscriptionContext provider (reducer shape, how to reconnect to orphaned async operations)
- Whether to use React useBlocker for navigation warnings or handle it differently

</decisions>

<specifics>
## Specific Ideas

- "Processes should not depend on which screen the user is on" — this is the core design principle
- The existing SettingsContext and ProjectsContext patterns (useReducer + createContext + Provider at root) are the established pattern to follow
- Phase 6 already built fileUri persistence (valid 48h) and debouncedSaveTranscript infrastructure — this phase lifts those into the provider, not rebuilds them
- The toast on nav-away + persistent sidebar indicator combo was explicitly chosen over either alone

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

_Phase: 06.1-transcription-state-architecture_
_Context gathered: 2026-02-08_
